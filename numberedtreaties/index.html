<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Numbered Treaties of Canada</title>
  
  <!-- Load Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  
  <!-- Load Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body, html { 
      margin: 0; 
      padding: 0; 
      width: 100%; 
      height: 100%; 
      display: flex; 
      font-family: 'Inter', sans-serif; 
      background-color: #f8fafc; /* Light grey background */
      color: #334155; /* Slate text */
      overflow: hidden;
    }
    /* Use a light blue for the map background */
    .leaflet-container { background: #e0f2fe; }
    #map { 
      flex: 1; 
      height: 100%; 
      border-right: 1px solid #cbd5e1; /* Slate border */
    }
    #info-panel { 
      width: 400px; 
      max-width: 40%; 
      padding: 2rem; 
      background: #ffffff; 
      border-left: 4px solid #0ea5e9; /* Blue accent */
      overflow-y: auto; 
      box-shadow: -5px 0 15px rgba(0,0,0,0.05); 
      display: flex; 
      flex-direction: column; 
    }
    #info-panel h2 { 
      margin-top: 0; 
      color: #0c4a6e; /* Dark blue title */
      font-size: 1.75rem; 
      font-weight: 700; 
      border-bottom: 2px solid #e0f2fe; 
      padding-bottom: 0.5rem; 
      margin-bottom: 1rem; 
    }
    #info-content h3 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #0ea5e9; /* Blue heading */
      margin-top: 0;
      margin-bottom: 0.75rem;
    }
    #info-content h4 {
      font-size: 1rem;
      font-weight: 600;
      color: #0c4a6e;
      margin-top: 1.25rem;
      margin-bottom: 0.5rem;
      border-bottom: 1px solid #e0f2fe;
      padding-bottom: 0.25rem;
    }
    #info-content p {
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: 1rem;
    }
    #info-content ul {
      list-style-type: disc;
      padding-left: 1.5rem;
      margin: 0 0 1rem 0;
      font-size: 0.9rem;
    }
    #info-content li {
      margin-bottom: 0.5rem;
    }
    
    .source-info {
        margin-top: 1.5rem;
        padding-top: 1rem;
        border-top: 1px solid #e2e8f0;
        font-size: 0.8rem;
    }
    .source-info a {
        color: #0ea5e9;
        text-decoration: none;
    }
    .source-info a:hover {
        text-decoration: underline;
    }
    .source-info p {
        margin-bottom: 0.5rem;
    }

    /* Leaflet Popup Styles */
    .leaflet-popup-content-wrapper { 
      background-color: #ffffff; 
      color: #0c4a6e; 
      border-radius: 8px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
    }
    .leaflet-popup-content { 
      font-weight: 600; 
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      margin: 10px 15px;
    }
    .leaflet-popup-tip { background: #ffffff; }
  </style>
</head>
<body>

  <div id="map"></div>
  
  <div id="info-panel">
    <h2>Numbered Treaties of Canada</h2>
    <div id="info-content">
      <p>Click a treaty area on the map to learn more about it.</p>
      
      <h4>About the Numbered Treaties</h4>
      <p>The Numbered Treaties are a series of eleven treaties signed between the Crown (representing the Canadian government) and First Nations peoples between 1871 and 1921. These agreements cover large parts of Canada, from Ontario to the Rocky Mountains and from the US border to the Arctic.</p>
      <p>While the government's primary goal was to acquire land for settlement, agriculture, and industry, First Nations sought to protect their livelihoods, cultures, and futures in the face of massive change, including the decline of the bison and the influx of settlers.</p>
      <p>Interpretations of these treaties differ. The written English texts emphasize the "surrender" of land in exchange for reserves, payments, and certain rights. However, First Nations oral traditions and perspectives often understand the treaties as sacred, nation-to-nation agreements to share, not surrender, the land and to live in peace and mutual support "as long as the sun shines, the grass grows and the rivers flow."</p>

      <h4>Lands Outside the Treaties</h4>
      <p>Large areas of Canada, including most of British Columbia, Quebec, and the Maritimes, are not covered by the Numbered Treaties. These lands are often the traditional, unceded territories of First Nations, Inuit, and MÃ©tis peoples, meaning they were never formally surrendered to the Crown. In many of these regions, earlier Peace and Friendship Treaties (which did not surrender land) or modern Comprehensive Land Claim Agreements (Modern Treaties) are in place.</p>

      <div class="source-info">
        <p><strong>General Resources:</strong></p>
        <ul>
            <li><a href="https://thecanadianencyclopedia.ca/en/article/numbered-treaties" target="_blank" rel="noopener noreferrer">The Canadian Encyclopedia - Numbered Treaties</a></li>
            <li><a href="https://www.rcaanc-cirnac.gc.ca/eng/1100100032297/1544716489360" target="_blank" rel="noopener noreferrer">Crown-Indigenous Relations - Historic Treaties</a></li>
            <li><a href="https://www.rcaanc-cirnac.gc.ca/eng/1360948213124/1544620003549" target="_blank" rel="noopener noreferrer">RCAANC - A map of the Numbered Treaties</a></li>
        </ul>
      </div>
    </div>
  </div>
  
  
  <!-- Load Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script>
    // --- 1. DOM & MAP SETUP ---
    const map = L.map('map', { zoomControl: true }).setView([60, -95], 4);
    
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
      subdomains: 'abcd', 
      maxZoom: 19
    }).addTo(map);

    const infoContent = document.getElementById('info-content');
    const defaultInfoPanelHTML = infoContent.innerHTML; // Store the default content
    let geojsonLayer;
    
    /**
     * Resets the info panel to its default introductory content.
     */
    function resetInfoPanel() {
      infoContent.innerHTML = defaultInfoPanelHTML;
    }

    // Add a click listener to the map itself.
    map.on('click', resetInfoPanel);

    // --- 2. DATA ---
    
    // pSBC function for lightening/darkening colors
    const pSBC=(p,c0)=>{let r,g,b,P,f,t,h,i=parseInt,m=Math.round;if(typeof p!="number"||p<-1||p>1||typeof c0!="string"||(c0[0]!='r'&&c0[0]!='#'))return null;if(!this.pSBCr)this.pSBCr=(d)=>{let n=d.length,x={};if(n>9){[r,g,b,a]=d=d.split(","),n=d.length;if(n<3||n>4)return null;x.r=i(r[3]=="a"?r.slice(5):r.slice(4)),x.g=i(g),x.b=i(b),x.a=a?parseFloat(a):-1}else{if(n==8||n==6||n<4)return null;if(n<6)d="#"+d[1]+d[1]+d[2]+d[2]+d[3]+d[3]+(n>4?d[4]+d[4]:"");d=i(d.slice(1),16);if(n==9||n==5)x.r=d>>24&255,x.g=d>>16&255,x.b=d>>8&255,x.a=m((d&255)/0.255)/1000;else x.r=d>>16,x.g=d>>8&255,x.b=d&255,x.a=-1}return x};h=c0.length>9,f=this.pSBCr(c0),P=p<0,t=P?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},p=P?p*-1:p,P=1-p;if(!f)return null;r=m(P*f.r+p*t.r);g=m(P*f.g+p*t.g);b=m(P*f.b+p*t.b);return"#"+(4294967296+r*16777216+g*65536+b*256).toString(16).slice(1)};

    // Historic, muted color scheme
    const treatyColors = {
      '1': '#c9af96', // Parchment
      '2': '#a8b6bf', // Faded Blue
      '3': '#d1bfa7', // Light Tan
      '4': '#b4c9b4', // Sage Green
      '5': '#e6d9b1', // Cream
      '6': '#a2c6a2', // Muted Green
      '7': '#d6a0a0', // Faded Red
      '8': '#b2a6c9', // Muted Purple
      '9': '#c7d6d9', // Light Grey-Blue
      '10': '#d4c7a1', // Olive Tan
      '11': '#d1b399'  // Muted Orange
    };

    // Researched data for each treaty
    const treatyData = {
      '1': {
        summary: "Signed in 1871 at Lower Fort Garry, Manitoba. It was the first of the Numbered Treaties, covering southern Manitoba. First Nations involved include the Anishinaabe (Ojibway) and Muskegon (Swampy Cree).",
        context: "The treaty was negotiated to open the land for settlement following the Red River Resistance and Manitoba's entry into Confederation. Key promises included reserves, small cash payments, and provisions for schools."
      },
      '2': {
        summary: "Signed in 1871 at Manitoba House. This treaty covers a large area of south-central Manitoba and a portion of Saskatchewan. It was also signed by Anishinaabe (Ojibway) and Swampy Cree peoples.",
        context: "Often seen as an extension of Treaty 1, it offered very similar terms and was intended to secure a larger territory for European settlement and agriculture."
      },
      '3': {
        summary: "Signed in 1873 at Lake of the Woods. This treaty covers a large area of northwestern Ontario and a small part of eastern Manitoba. The signatories were primarily Saulteaux (Anishinaabe/Ojibway).",
        context: "This treaty was crucial for Canada to secure the 'Dawson Route,' a transportation corridor to the west. First Nations negotiators were particularly strong, securing more extensive reserve lands and rights than in Treaties 1 and 2."
      },
      '4': {
        summary: "Signed in 1874 at Fort Qu'Appelle, Saskatchewan. It covers most of southern Saskatchewan. Signatories include the Cree, Saulteaux (Anishinaabe), and Assiniboine.",
        context: "Negotiated as the North-West Mounted Police (NWMP) were establishing their presence. The rapid decline of the bison was a major concern for the First Nations, who sought government assistance and a transition to an agricultural lifestyle."
      },
      '5': {
        summary: "Signed in 1875 at Berens River, Manitoba. It covers a vast territory in central and northern Manitoba, as well as parts of Saskatchewan and Ontario. Signatories were mainly Saulteaux (Anishinaabe) and Swampy Cree.",
        context: "This treaty was sought by Canada to secure transportation routes (Lake Winnipeg) and access to natural resources. Adhesions (later signings) were added as late as 1908 to include more northern communities."
      },
      '6': {
        summary: "Signed in 1876 at Fort Carlton and Fort Pitt, Saskatchewan. It covers a vast area of central Alberta and Saskatchewan. Signatories include the Cree, Assiniboine, and Stoney Nakoda.",
        context: "This treaty is unique for its inclusion of a 'medicine chest' clause, which First Nations interpret as a promise of health care. It also includes a 'famine and pestilence' clause, promising aid in times of crisis, reflecting the dire situation of the declining bison."
      },
      '7': {
        summary: "Signed in 1877 at Blackfoot Crossing in southern Alberta. This treaty is with the Siksika (Blackfoot), Kainai (Blood), Piikani (Peigan), Stoney Nakoda, and Tsuut'ina (Sarcee) Nations.",
        context: "Unlike other treaties focused on agriculture, Treaty 7 was negotiated with nations who had a strong equestrian and buffalo-hunting culture. There are significant disputes over whether the nations understood this as a land surrender or a peace and resource-sharing agreement."
      },
      '8': {
        summary: "Signed in 1899 at Lesser Slave Lake. It is a massive treaty covering northern Alberta, northeastern British Columbia, northwestern Saskatchewan, and a southern portion of the Northwest Territories.",
        context: "This treaty was prompted by the Klondike Gold Rush, as the government wanted to ensure safe passage for prospectors and access to resources. The terms were different, offering larger land grants (160 acres per person) or scrip, due to the northern hunting and trapping lifestyle."
      },
      '9': {
        summary: "Signed in 1905-1906 at various locations in northern Ontario. Also known as the James Bay Treaty, it covers a large part of the province.",
        context: "This treaty was negotiated jointly by the governments of Canada and Ontario, as the province was interested in the region's natural resources (timber, minerals). Adhesions were signed in 1929-1930."
      },
      '10': {
        summary: "Signed in 1906 and 1907 in northern Saskatchewan and a small part of Alberta.",
        context: "This treaty was negotiated to secure lands that were left out of Treaties 6 and 8. It was driven by government interest in resources and sovereignty over the north. The terms were similar to Treaty 8."
      },
      '11': {
        summary: "Signed in 1921 at various locations in the Northwest Territories. It is the last of the Numbered Treaties.",
        context: "This treaty was prompted by the discovery of oil at Norman Wells. The Dene and Gwich'in peoples who signed have long maintained that they understood it as a treaty of peace and friendship, not a surrender of their land. This dispute is central to modern land claims in the region."
      }
    };

    // --- 3. MAP INTERACTIVITY ---

    /**
     * Robustly gets the treaty number from feature properties.
     * Uses ENAME as the primary source, based on user screenshot.
     */
    function getTreatyNumber(props) {
      if (!props) return null;

      // The key property from the screenshot is ENAME
      const label = props.ENAME || ""; // e.g., "Treaty #8 (1899)"
      
      // Extract the number. Match "Treaty #8" or "Treaty 8"
      const match = label.match(/Treaty\s*#?(\d+)/); 
      if (match && match[1]) {
        return match[1]; // Returns "8"
      }
      
      // Fallback for other properties just in case
      if (props.TREATY_NUM) return String(props.TREATY_NUM);
      if (props.NUMBER) return String(props.NUMBER);
      if (props.TREATY) return String(props.TREATY);

      return null; // Failed
    }

    /**
     * Robustly gets the treaty label from feature properties.
     * Prioritizes 'ENAME' based on user screenshot.
     */
    function getTreatyLabel(props) {
      if (!props) return "Numbered Treaty";
      
      // The key property from the screenshot is ENAME
      return props.ENAME || props.name || props.NAME || "Numbered Treaty";
    }

    /**
     * Styles the map features based on their treaty number.
     */
    function style(feature) {
      const treatyNum = getTreatyNumber(feature.properties);
      const baseColor = treatyColors[treatyNum] || '#ccc'; // Default to grey if not found
      
      return { 
        fillColor: baseColor, 
        weight: 2, // A thin border
        color: baseColor, // Border is same as fill to remove white space
        fillOpacity: 0.6 
      };
    }

    /**
     * Highlights the feature on mouseover.
     */
    function highlightFeature(e) {
      const layer = e.target;
      const treatyNum = getTreatyNumber(layer.feature.properties);
      const baseColor = treatyColors[treatyNum] || '#ccc';

      layer.setStyle({
        weight: 4, // Thicker border on hover
        color: pSBC(-0.4, baseColor), // Darker border for highlight
        fillOpacity: 0.8 // Slightly less transparent when hovered
      });
      layer.bringToFront();
    }

    /**
     * Resets the highlight on mouseout.
     */
    function resetHighlight(e) { 
        if (geojsonLayer) {
            geojsonLayer.resetStyle(e.target); 
        }
    }

    /**
     * Handles clicks on a feature: updates the info panel.
     */
    function clickFeature(e) {
      L.DomEvent.stopPropagation(e); // Stop click from bubbling to map
      const props = e.target.feature.properties;
      
      // Use helpers to get data
      const treatyNum = getTreatyNumber(props);
      const treatyLabel = getTreatyLabel(props);
      const data = treatyData[treatyNum]; // Get researched data

      let content = `<h3>${treatyLabel}</h3>`;

      if (data) {
        // Add researched data
        content += `<h4>Summary</h4><p>${data.summary}</p>`;
        content += `<h4>Context & Significance</h4><p>${data.context}</p>`;
      } else {
        // Fallback if no researched data
        content += `<p>No detailed information available for this treaty in our database.</p>`;
      }

      infoContent.innerHTML = content;
      e.target.bringToFront();
    }

    /**
     * Attaches events to each map layer.
     */
    function onEachFeature(feature, layer) {
      // Use helper to find the label for the popup
      const treatyLabel = getTreatyLabel(feature.properties);
      layer.bindPopup(treatyLabel);

      layer.on({ 
        mouseover: highlightFeature, 
        mouseout: resetHighlight,
        click: clickFeature 
      });
    }

    // --- 4. DATA FETCHING ---
    // Use the RAW content link for the GeoJSON
    const url = 'https://raw.githubusercontent.com/Maltais239/interactives/main/numbered_treaties.geojson';
    
    fetch(url)
      .then(res => res.ok ? res.json() : Promise.reject(res.status))
      .then(data => { 
        geojsonLayer = L.geoJson(data, { style, onEachFeature }).addTo(map); 
        // Fit map to the bounds of the treaty data
        map.fitBounds(geojsonLayer.getBounds());
      })
      .catch((err) => { 
        console.error("Error fetching GeoJSON:", err);
        infoContent.innerHTML = `<p style="color: red;"><strong>Error:</strong> Could not load map data from GitHub. The file might be private, moved, or the URL is incorrect.</p>`; 
      });
  </script>
</body>
</html>

