<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pirate Treasure Hunt</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English+SC&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'IM Fell English SC', serif;
            overflow-y: auto;
        }
        /* Style for the canvas element */
        canvas {
            background-color: #ffffff;
            display: block;
            border: 4px solid #6b4f3a;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }
        .wood-panel {
            background-color: #8B4513; /* SaddleBrown */
            background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.05) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.05) 50%, rgba(255, 255, 255, 0.05) 75%, transparent 75%, transparent);
            background-size: 50px 50px;
            border: 4px solid #6b4f3a;
        }
    </style>
</head>
<body class="bg-[#d2b48c] text-[#3a2d22]">

    <div class="container mx-auto p-4 md:p-8">
        <h1 class="text-4xl md:text-6xl text-center mb-6 text-yellow-900 drop-shadow-lg">Pirate Treasure Hunt</h1>

        <div class="flex flex-col md:flex-row gap-8">
            <!-- Game Canvas -->
            <div class="w-full md:w-3/4">
                <canvas id="gameCanvas"></canvas>
            </div>

            <!-- Instructions Panel -->
            <div class="w-full md:w-1/4 p-6 wood-panel rounded-lg shadow-xl text-yellow-50">
                <h2 class="text-3xl border-b-2 border-yellow-200 pb-2 mb-4">Captain's Orders</h2>
                <div id="instructions" class="text-xl space-y-2 mb-6">
                    <p>Loadin' the map, matey...</p>
                </div>
                 <div class="mb-6 text-xl">
                    <p>Treasures Found: <span id="tallyCount">0</span></p>
                </div>
                <div class="flex flex-col gap-4">
                    <button id="newGameBtn" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition duration-200 ease-in-out transform hover:scale-105">
                        Find New Treasure Manually
                    </button>
                    <button id="backToStartBtn" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition duration-200 ease-in-out transform hover:scale-105">
                        Back to Start
                    </button>
                </div>
                 <div id="winMessage" class="mt-6 p-4 bg-green-700 text-white rounded-lg text-center text-2xl hidden">
                    You found the treasure!
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const instructionsDiv = document.getElementById('instructions');
        const newGameBtn = document.getElementById('newGameBtn');
        const backToStartBtn = document.getElementById('backToStartBtn');
        const winMessage = document.getElementById('winMessage');
        const tallyCountSpan = document.getElementById('tallyCount');

        // --- Game Configuration ---
        const GRID_WIDTH = 12; // Total grid width
        const GRID_HEIGHT = 9;  // Total grid height
        const ISLAND_BORDER = 1; // 1 square of ocean on each side
        const MAX_PACE = 9;
        const STEP_SIZE = 1;
        let TILE_WIDTH;
        let TILE_HEIGHT;
        // Corrected the player image URL by adding the .png extension
        const PLAYER_IMG_URL = 'https://cdn.jsdelivr.net/gh/Maltais239/Images@main/piratefox.png';
        const MAP_IMG_URL = 'https://cdn.jsdelivr.net/gh/Maltais239/Images@main/Pirate%20Map.png';

        // --- Game State ---
        let player = { x: 0, y: 0 };
        let startPosition = { x: 0, y: 0 };
        let treasure = { x: 0, y: 0 };
        let tallyCount = 0;
        let isRoundOver = false;
        let playerImage = new Image();
        let mapImage = new Image();
        let gameReady = false;

        // --- Image Loading ---
        let assetsToLoad = 2;
        let assetsLoaded = 0;

        function assetLoaded(assetName) {
            assetsLoaded++;
            if (assetsLoaded >= assetsToLoad) {
                gameReady = true;
                initializeGame();
            }
        }

        function loadImages() {
            playerImage.crossOrigin = "Anonymous";
            mapImage.crossOrigin = "Anonymous";
            playerImage.onload = () => assetLoaded('Player');
            playerImage.onerror = () => instructionsDiv.innerHTML = `<p class="text-red-300">Error: Could not load the Pirate Fox image.</p>`;
            mapImage.onload = () => assetLoaded('Map');
            mapImage.onerror = () => instructionsDiv.innerHTML = `<p class="text-red-300">Error: Could not load the Treasure Map.</p>`;
            playerImage.src = PLAYER_IMG_URL;
            mapImage.src = MAP_IMG_URL;
        }
        
        // --- Game Initialization ---
        function initializeGame() {
            if (!gameReady) return;
            resizeCanvas();
            startNewRound();
        }

        function startNewRound() {
            isRoundOver = false;
            winMessage.classList.add('hidden');
            
            const islandWidth = GRID_WIDTH - (ISLAND_BORDER * 2);
            const islandHeight = GRID_HEIGHT - (ISLAND_BORDER * 2);

            player.x = ISLAND_BORDER + Math.floor(Math.random() * islandWidth);
            player.y = ISLAND_BORDER + Math.floor(Math.random() * islandHeight);
            
            startPosition.x = player.x;
            startPosition.y = player.y;

            let dx, dy;
            do {
                treasure.x = ISLAND_BORDER + Math.floor(Math.random() * islandWidth);
                treasure.y = ISLAND_BORDER + Math.floor(Math.random() * islandHeight);
                dx = Math.abs(treasure.x - player.x);
                dy = Math.abs(treasure.y - player.y);
            } while ((dx === 0 && dy === 0) || dx > MAX_PACE || dy > MAX_PACE);
            
            generateInstructions();
            draw();
        }

        // --- Responsive Canvas ---
        function resizeCanvas() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            const aspectRatio = 4 / 3; 

            canvas.width = containerWidth;
            canvas.height = containerWidth / aspectRatio;
            
            if (canvas.height > window.innerHeight * 0.8) {
                canvas.height = window.innerHeight * 0.8;
                canvas.width = canvas.height * aspectRatio;
            }

            TILE_WIDTH = canvas.width / GRID_WIDTH;
            TILE_HEIGHT = canvas.height / GRID_HEIGHT;

            if (gameReady) draw();
        }

        // --- Drawing ---
        function draw() {
            if (!gameReady) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (mapImage.complete) ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);
            if (playerImage.complete) ctx.drawImage(playerImage, player.x * TILE_WIDTH, player.y * TILE_HEIGHT, TILE_WIDTH, TILE_HEIGHT);
            if (player.x === treasure.x && player.y === treasure.y) drawTreasure();
        }

        function drawTreasure() {
            ctx.font = `${Math.min(TILE_WIDTH, TILE_HEIGHT) * 0.8}px serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ðŸ‘‘', (treasure.x + 0.5) * TILE_WIDTH, (treasure.y + 0.5) * TILE_HEIGHT);
        }

        // --- Game Logic ---
        function generateInstructions() {
            const dx = treasure.x - player.x;
            const dy = treasure.y - player.y;

            let instructionsHTML = '';
            if (dx > 0) instructionsHTML += `<p>${dx} Paces East</p>`;
            else if (dx < 0) instructionsHTML += `<p>${-dx} Paces West</p>`;
            if (dy > 0) instructionsHTML += `<p>${dy} Paces South</p>`;
            else if (dy < 0) instructionsHTML += `<p>${-dy} Paces North</p>`;
            if (dx === 0 && dy === 0) instructionsHTML = "<p>You're standin' on it, Captain!</p>";
            instructionsDiv.innerHTML = instructionsHTML;
        }

        function checkWinCondition() {
            if (isRoundOver) return; // Prevent multiple triggers

            if (player.x === treasure.x && player.y === treasure.y) {
                isRoundOver = true; // Lock controls
                winMessage.classList.remove('hidden');
                tallyCount++;
                tallyCountSpan.innerText = tallyCount;
                draw();

                // Automatically start the next round after 2 seconds
                setTimeout(startNewRound, 2000);
            }
        }
        
        // --- Input Handling ---
        function handleKeyDown(e) {
            if (!gameReady || isRoundOver) return;

            let moved = false;
            const minX = ISLAND_BORDER;
            const maxX = GRID_WIDTH - 1 - ISLAND_BORDER;
            const minY = ISLAND_BORDER;
            const maxY = GRID_HEIGHT - 1 - ISLAND_BORDER;

            switch (e.key) {
                case "ArrowUp":
                    if (player.y > minY) { player.y = Math.max(minY, player.y - STEP_SIZE); moved = true; }
                    break;
                case "ArrowDown":
                    if (player.y < maxY) { player.y = Math.min(maxY, player.y + STEP_SIZE); moved = true; }
                    break;
                case "ArrowLeft":
                    if (player.x > minX) { player.x = Math.max(minX, player.x - STEP_SIZE); moved = true; }
                    break;
                case "ArrowRight":
                    if (player.x < maxX) { player.x = Math.min(maxX, player.x + STEP_SIZE); moved = true; }
                    break;
            }

            if(moved) {
                e.preventDefault();
                draw();
                checkWinCondition();
            }
        }
        
        function handleBackToStart() {
            if (!gameReady || isRoundOver) return;
            player.x = startPosition.x;
            player.y = startPosition.y;
            draw();
        }

        // --- Event Listeners ---
        window.addEventListener('load', loadImages);
        window.addEventListener('resize', resizeCanvas);
        document.addEventListener('keydown', handleKeyDown);
        newGameBtn.addEventListener('click', startNewRound);
        backToStartBtn.addEventListener('click', handleBackToStart);

    </script>
</body>
</html>
