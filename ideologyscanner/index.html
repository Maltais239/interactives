<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spectrum Analyzer: Individualism vs Collectivism</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        
        h1, h2, h3, .fun-font {
            font-family: 'Fredoka', sans-serif;
        }

        .spectrum-gradient {
            background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #e2e8f0 50%, #3b82f6 75%, #1d4ed8 100%);
        }

        .highlight-red {
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .highlight-blue {
            background-color: #dbeafe;
            color: #1d4ed8;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const IconScale = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>
        );

        const IconBookOpen = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        );

        const IconSearch = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
        );

        const IconPlus = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        );

        const IconTrash = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
        );

        // --- Keyword Dictionary ---
        // Based on curriculum concepts
        const keywords = {
            individualism: [
                "private property", "self-reliance", "personal responsibility", "freedom of choice", 
                "economic freedom", "competition", "individual rights", "rule of law", "profit", 
                "consumer", "market", "capitalism", "deregulation", "privatization", "owner", 
                "independence", "liberty", "individual", "business", "buy", "sell", "trade"
            ],
            collectivism: [
                "public property", "common good", "collective interest", "economic equality", 
                "cooperation", "collective responsibility", "collective norms", "planned economy", 
                "command economy", "government control", "social programs", "welfare", "public ownership", 
                "union", "share", "community", "state", "regulation", "intervention", "tax", "group"
            ]
        };

        const App = () => {
            const [inputText, setInputText] = useState("");
            const [score, setScore] = useState(50); // 0 = Collectivism, 100 = Individualism
            const [foundTerms, setFoundTerms] = useState({ ind: [], col: [] });
            const [history, setHistory] = useState([]);
            const [showCurriculum, setShowCurriculum] = useState(false);
            const [isTyping, setIsTyping] = useState(false);

            // Analysis Logic with Debounce
            useEffect(() => {
                // Reset state immediately if empty
                if (!inputText.trim()) {
                    setScore(50);
                    setFoundTerms({ ind: [], col: [] });
                    setIsTyping(false);
                    return;
                }

                setIsTyping(true);

                // Set a timeout to delay analysis (Debounce)
                const delayDebounceFn = setTimeout(() => {
                    analyzeText();
                    setIsTyping(false);
                }, 600); // Wait 600ms after user stops typing

                return () => clearTimeout(delayDebounceFn);
            }, [inputText]);

            const analyzeText = () => {
                let textToScan = inputText.toLowerCase();
                const matchedInd = [];
                const matchedCol = [];

                // 1. Merge all keywords into one list with metadata
                const allKeywords = [
                    ...keywords.individualism.map(k => ({ term: k, type: 'ind' })),
                    ...keywords.collectivism.map(k => ({ term: k, type: 'col' }))
                ];

                // 2. Sort by length (descending) to match "Individual Rights" before "Individual"
                allKeywords.sort((a, b) => b.term.length - a.term.length);

                // 3. Scan and consume text
                allKeywords.forEach(({ term, type }) => {
                    // Regex for whole word matching
                    // Escape special characters in term just in case
                    const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`\\b${escapedTerm}\\b`, 'gi');

                    if (regex.test(textToScan)) {
                        if (type === 'ind') matchedInd.push(term);
                        if (type === 'col') matchedCol.push(term);
                        
                        // "Consume" the matched term from the temp text so it isn't matched again by shorter words
                        // We replace it with spaces to preserve indices/boundaries if we were doing more complex stuff, 
                        // but here we just need to ensure "individual" doesn't match the "individual" in "individual rights"
                        textToScan = textToScan.replace(regex, ' '.repeat(term.length));
                    }
                });

                setFoundTerms({ ind: matchedInd, col: matchedCol });

                // Scoring Logic
                let newScore = 50;
                const pointsPerTerm = 10; // Reduced from 15 to be less jumpy

                newScore -= (matchedCol.length * pointsPerTerm);
                newScore += (matchedInd.length * pointsPerTerm);

                // Clamp score between 5 and 95
                newScore = Math.max(5, Math.min(95, newScore));
                
                setScore(newScore);
            };

            const saveEntry = () => {
                if (!inputText.trim()) return;
                
                const newEntry = {
                    id: Date.now(),
                    text: inputText,
                    score: score,
                    terms: foundTerms
                };

                setHistory([newEntry, ...history]);
                setInputText(""); // Clear box after saving
            };

            const getAnalysisLabel = (s) => {
                if (s < 30) return "Collectivist";
                if (s < 45) return "Leaning Collective";
                if (s <= 55) return "Mixed / Center";
                if (s <= 70) return "Leaning Individualist";
                return "Individualist";
            };

            const getAnalysisColor = (s) => {
                if (s < 45) return "text-red-600";
                if (s <= 55) return "text-purple-600";
                return "text-blue-600";
            };

            return (
                <div className="min-h-screen pb-12 flex flex-col">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-20 shadow-sm">
                        <div className="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <div className="p-2 bg-gradient-to-r from-red-500 to-blue-500 rounded-lg text-white">
                                    <IconScale size={24} />
                                </div>
                                <h1 className="text-xl md:text-2xl font-bold text-slate-800">Ideology Scanner</h1>
                            </div>
                            <button 
                                onClick={() => setShowCurriculum(!showCurriculum)}
                                className="flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-blue-600 transition-colors bg-slate-100 px-3 py-2 rounded-lg"
                            >
                                <IconBookOpen size={18} />
                                {showCurriculum ? 'Concepts' : 'Concepts'}
                            </button>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-4 py-8 flex-grow w-full">
                        
                        {/* Curriculum Help Box */}
                        {showCurriculum && (
                            <div className="mb-6 bg-blue-50 border border-blue-200 rounded-xl p-6 text-sm text-slate-700 animate-fade-in-up">
                                <h3 className="font-bold text-lg text-blue-800 mb-2">Keyword Cheatsheet</h3>
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <strong className="block text-blue-700 mb-1">Individualism Keywords</strong>
                                        <p className="text-xs italic">Try typing: private property, competition, profit, freedom, self-reliance...</p>
                                    </div>
                                    <div>
                                        <strong className="block text-red-700 mb-1">Collectivism Keywords</strong>
                                        <p className="text-xs italic">Try typing: public property, cooperation, equality, government control, shared...</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Spectrum Visualization (The "Top" requested to keep) */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-8 border border-slate-100 sticky top-20 z-10 transition-all duration-300">
                            <div className="flex justify-between text-xs md:text-sm font-bold uppercase tracking-wide text-slate-400 mb-2">
                                <span className="text-red-500">Collectivism</span>
                                <span className="text-purple-500">Center</span>
                                <span className="text-blue-500">Individualism</span>
                            </div>
                            
                            <div className="relative h-12 w-full rounded-full spectrum-gradient shadow-inner mb-6">
                                {/* The Needle */}
                                <div 
                                    className="absolute top-0 bottom-0 w-1 bg-white border-x-2 border-slate-800 z-10 transition-all duration-500 ease-out"
                                    style={{ left: `${score}%` }}
                                >
                                    <div className="absolute -top-3 -translate-x-1/2 left-1/2">
                                        <div className={`w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[12px] transition-colors ${isTyping ? 'border-t-slate-300' : 'border-t-slate-800'}`}></div>
                                    </div>
                                    <div className={`absolute -bottom-10 -translate-x-1/2 left-1/2 bg-slate-800 text-white text-xs font-bold py-1 px-3 rounded-full whitespace-nowrap shadow-lg transition-opacity ${isTyping ? 'opacity-50' : 'opacity-100'}`}>
                                        {isTyping ? "Analyzing..." : getAnalysisLabel(score)}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Input Area */}
                        <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                            <div className="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                                <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                    <IconSearch size={18} /> Analyzer Input
                                </h3>
                                <span className="text-xs text-slate-400">Type a scenario below</span>
                            </div>
                            
                            <div className="p-4">
                                <textarea
                                    className="w-full h-32 p-4 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none resize-none transition-all text-slate-700 bg-slate-50 focus:bg-white"
                                    placeholder="Example: The government owns all the factories and ensures everyone earns the same wage..."
                                    value={inputText}
                                    onChange={(e) => setInputText(e.target.value)}
                                ></textarea>

                                {/* Live detected terms */}
                                <div className="mt-4 flex flex-wrap gap-2 min-h-[2rem]">
                                    {foundTerms.col.map((term, i) => (
                                        <span key={`c-${i}`} className="highlight-red text-xs animate-pulse">
                                            {term}
                                        </span>
                                    ))}
                                    {foundTerms.ind.map((term, i) => (
                                        <span key={`i-${i}`} className="highlight-blue text-xs animate-pulse">
                                            {term}
                                        </span>
                                    ))}
                                    {(foundTerms.col.length === 0 && foundTerms.ind.length === 0 && inputText.length > 5 && !isTyping) && (
                                        <span className="text-xs text-slate-400 italic">
                                            No keywords detected yet... try words like "competition" or "equality"
                                        </span>
                                    )}
                                     {isTyping && (
                                        <span className="text-xs text-slate-400 italic animate-pulse">
                                            Scanning...
                                        </span>
                                    )}
                                </div>

                                <div className="mt-4 flex justify-end">
                                    <button
                                        onClick={saveEntry}
                                        disabled={!inputText.trim()}
                                        className="bg-slate-900 hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-2 rounded-lg font-medium transition-colors flex items-center gap-2"
                                    >
                                        <IconPlus size={18} /> Save to Description Box
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* History / Description Box */}
                        <div>
                            <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <IconBookOpen size={20} /> Saved Descriptions
                            </h3>
                            
                            {history.length === 0 ? (
                                <div className="text-center py-12 bg-slate-100 rounded-xl border-2 border-dashed border-slate-200 text-slate-400">
                                    <p>Your saved analyses will appear here.</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {history.map((entry) => (
                                        <div key={entry.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex gap-4 animate-fade-in-up">
                                            {/* Mini score indicator */}
                                            <div className="flex flex-col items-center justify-center min-w-[60px] border-r border-slate-100 pr-4">
                                                <div className={`w-3 h-3 rounded-full mb-1 ${getAnalysisColor(entry.score).replace('text', 'bg')}`}></div>
                                                <span className={`text-xs font-bold ${getAnalysisColor(entry.score)}`}>
                                                    {entry.score > 55 ? "IND" : entry.score < 45 ? "COL" : "MIX"}
                                                </span>
                                            </div>
                                            
                                            <div className="flex-grow">
                                                <p className="text-slate-700 mb-2">{entry.text}</p>
                                                <div className="flex flex-wrap gap-1">
                                                    {entry.terms.col.map((t, i) => (
                                                        <span key={i} className="px-2 py-0.5 bg-red-50 text-red-600 text-[10px] rounded uppercase font-bold tracking-wider">{t}</span>
                                                    ))}
                                                    {entry.terms.ind.map((t, i) => (
                                                        <span key={i} className="px-2 py-0.5 bg-blue-50 text-blue-600 text-[10px] rounded uppercase font-bold tracking-wider">{t}</span>
                                                    ))}
                                                </div>
                                            </div>

                                            <button 
                                                onClick={() => setHistory(history.filter(h => h.id !== entry.id))}
                                                className="text-slate-300 hover:text-red-500 transition-colors"
                                            >
                                                <IconTrash size={16} />
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                    </main>
                    
                    <footer className="text-center text-slate-400 text-xs py-8">
                        Social Studies Curriculum Tool â€¢ Type terms to analyze ideology
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in-up': 'fadeInUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
</body>
</html>
