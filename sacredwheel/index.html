<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sacred Circle</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-stone-200 overflow-hidden">

    <div id="root"></div>

    <script type="text/babel">
        // --- 1. SETUP: Destructure React hooks ---
        const { useState, useEffect, useCallback } = React;

        // --- 2. SETUP: Icon Definitions ---
        const IconBase = ({ d, size = 24, className = "", fill="none" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {d}
            </svg>
        );

        const Trophy = (props) => <IconBase {...props} d={<><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></>} />;
        const Info = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>} />;
        const RotateCcw = (props) => <IconBase {...props} d={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>} />;
        const CheckCircle2 = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></>} />;
        const Heart = (props) => <IconBase {...props} fill={props.fill || "none"} d={<path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />} />;
        const ArrowRight = (props) => <IconBase {...props} d={<><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></>} />;
        const BookOpen = (props) => <IconBase {...props} d={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />;
        const HelpCircle = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></>} />;

        // --- 3. ICONS ---
        const Icons = {
          spring: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83" /><circle cx="12" cy="12" r="4" /></svg>,
          infancy: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 12h6m-3-3v6M12 3a9 9 0 1 1 0 18 9 9 0 0 1 0-18z" /><path d="M12 8v8M8 12h8" /></svg>,
          tobacco: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2s-4 4-4 8 4 8 4 8 4-4 4-8-4-8-4-8z" /><path d="M12 22v-4" /></svg>,
          eagle: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 10c2-2 5-3 8-3s6 1 8 3l-2 10H5L3 10z" /><path d="M12 7V3l-2 2h4l-2-2" /></svg>,
          physical: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 20V10M12 20V4M6 20v-6" /></svg>,
          summer: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 12h2M4.22 19.78l1.42-1.42M16.24 7.76l1.42-1.42" /></svg>,
          youth: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87M18 3.13a4 4 0 0 1 0 7.75" /></svg>,
          cedar: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 19 7-7 3 3-7 7-3-3z" /><path d="m12 19-7-7-3 3 7 7 3-3z" /><path d="M12 2v17" /></svg>,
          coyote: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 14s1-5 4-5 5 2 5 2 4-2 7-2 1 10 1 10H4v-5z" /><path d="M8 9V5l2 2" /><path d="M16 9V5l-2 2" /></svg>,
          mental: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A5.5 5.5 0 0 0 4 7.5c0 1.63.71 3.1 1.84 4.12A4.5 4.5 0 0 1 7.5 15v1.5a1.5 1.5 0 0 0 3 0V15a4.5 4.5 0 0 1 1.66-3.38A5.5 5.5 0 0 0 9.5 2z" /><path d="M14.5 2A5.5 5.5 0 0 1 20 7.5c0 1.63-.71 3.1-1.84 4.12A4.5 4.5 0 0 0 16.5 15v1.5a1.5 1.5 0 0 1-3 0V15a4.5 4.5 0 0 0-1.66-3.38A5.5 5.5 0 0 1 14.5 2z" /></svg>,
          autumn: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 20a7 7 0 0 1-7-7c0-3.87 3.13-7 7-7s7 3.13 7 7a7 7 0 0 1-7 7z" /><path d="M11 11v5m-3-2 3 2 3-2" /></svg>,
          adult: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>,
          sage: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s-8-4-8-10c0-4.42 3.58-8 8-8s8 3.58 8 8c0 6-8 10-8 10z" /><path d="M12 12v6" /></svg>,
          bear: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="7" cy="5" r="2" /><circle cx="17" cy="5" r="2" /><path d="M2 12c0-4 4-7 10-7s10 3 10 7-4 7-10 7-10-3-10-7z" /><circle cx="12" cy="13" r="3" /></svg>,
          emotional: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></svg>,
          winter: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m2 12 10-10 10 10-10 10Z" /><path d="m12 2 4 4m-8 0 4-4m0 16 4-4m-8 0 4 4" /></svg>,
          elder: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M7 21v-2a4 4 0 0 1 4-4h2a4 4 0 0 1 4 4v2" /><circle cx="12" cy="7" r="4" /></svg>,
          sweetgrass: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2v20M8 5c2 2 2 4 0 6s-2 4 0 6 2 4 0 6M16 5c-2 2-2 4 0 6s2 4 0 6-2 4 0 6" /></svg>,
          buffalo: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12c0-5 4-8 9-8s9 3 9 8-4 8-9 8-9-3-9-8z" /><path d="M7 6c-1-1-3-1-4 0M17 6c1-1 3-1 4 0" /></svg>,
          spiritual: (cls) => <svg className={cls} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2 2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" /></svg>,
        };

        const TEACHINGS = {
          east: {
            color: 'bg-yellow-400',
            hoverColor: 'hover:bg-yellow-300',
            textColor: 'text-yellow-900',
            label: 'East',
            direction: 'Kihci-nâwayîhk',
            hint: "Hint: Think of the rising sun, the spring season, and things related to the physical body.",
            description: "The place of new beginnings. As the sun rises in the East, we honor the start of life and the physical body.",
            items: [
              { id: 'spring', text: 'Spring', category: 'Season', icon: 'spring' },
              { id: 'infancy', text: 'Infancy', category: 'Life Stage', icon: 'infancy' },
              { id: 'tobacco', text: 'Tobacco', category: 'Medicine', icon: 'tobacco' },
              { id: 'eagle', text: 'Eagle', category: 'Animal', icon: 'eagle' },
              { id: 'physical', text: 'Physical', category: 'Aspect', icon: 'physical' }
            ]
          },
          south: {
            color: 'bg-red-500',
            hoverColor: 'hover:bg-red-400',
            textColor: 'text-red-950',
            label: 'South',
            direction: 'Sâwanohk',
            hint: "Hint: Think of the warmth of summer, the energy of youth, and growth of the mind.",
            description: "The place of growth and warmth. Like the summer sun, this direction represents youth and the development of the mind.",
            items: [
              { id: 'summer', text: 'Summer', category: 'Season', icon: 'summer' },
              { id: 'youth', text: 'Youth', category: 'Life Stage', icon: 'youth' },
              { id: 'cedar', text: 'Cedar', category: 'Medicine', icon: 'cedar' },
              { id: 'coyote', text: 'Coyote', category: 'Animal', icon: 'coyote' },
              { id: 'mental', text: 'Mental', category: 'Aspect', icon: 'mental' }
            ]
          },
          west: {
            color: 'bg-blue-600',
            hoverColor: 'hover:bg-blue-500',
            textColor: 'text-blue-50',
            label: 'West',
            direction: 'Pahkisimotâhk',
            hint: "Hint: Think of where the sun sets, adulthood, and looking inward at emotions.",
            description: "The place of reflection. As the sun sets, we look inward to our emotions and the transition into adulthood.",
            items: [
              { id: 'autumn', text: 'Autumn', category: 'Season', icon: 'autumn' },
              { id: 'adult', text: 'Adulthood', category: 'Life Stage', icon: 'adult' },
              { id: 'sage', text: 'Sage', category: 'Medicine', icon: 'sage' },
              { id: 'bear', text: 'Bear', category: 'Animal', icon: 'bear' },
              { id: 'emotional', text: 'Emotional', category: 'Aspect', icon: 'emotional' }
            ]
          },
          north: {
            color: 'bg-zinc-100',
            hoverColor: 'hover:bg-white',
            textColor: 'text-zinc-800',
            label: 'North',
            direction: 'Kîwêtinohk',
            hint: "Hint: Think of the cold winter, the wisdom of elders, and spiritual strength.",
            description: "The place of wisdom and rest. The white snow represents our Elders and the spiritual strength needed for survival.",
            items: [
              { id: 'winter', text: 'Winter', category: 'Season', icon: 'winter' },
              { id: 'elder', text: 'Elder', category: 'Life Stage', icon: 'elder' },
              { id: 'sweetgrass', text: 'Sweetgrass', category: 'Medicine', icon: 'sweetgrass' },
              { id: 'buffalo', text: 'Buffalo', category: 'Animal', icon: 'buffalo' },
              { id: 'spiritual', text: 'Spiritual', category: 'Aspect', icon: 'spiritual' }
            ]
          }
        };

        const App = () => {
          const [gameState, setGameState] = useState('intro'); // intro, teaching, playing, complete
          const [teachingIndex, setTeachingIndex] = useState(0);
          const [score, setScore] = useState(0);
          const [placedItems, setPlacedItems] = useState([]);
          const [availableItems, setAvailableItems] = useState([]);
          const [draggedItem, setDraggedItem] = useState(null);
          const [message, setMessage] = useState({ text: 'Welcome. Observe the teachings.', type: 'info' });
          const [showInfo, setShowInfo] = useState(false);

          const teachingOrder = ['east', 'south', 'west', 'north'];

          const startTeaching = () => {
            setTeachingIndex(0);
            setGameState('teaching');
          };

          const nextTeaching = () => {
            if (teachingIndex < 3) {
              setTeachingIndex(prev => prev + 1);
            } else {
              initGameChallenge();
            }
          };

          const initGameChallenge = useCallback(() => {
            const allItems = Object.entries(TEACHINGS).flatMap(([dir, data]) => 
              data.items.map(item => ({ ...item, target: dir }))
            );

            // Generate scattered positions ensuring they aren't inside the center
            const generatePosition = () => {
                let x, y, dist;
                let attempts = 0;
                do {
                    // X: 5% to 95%
                    x = Math.random() * 90 + 5; 
                    // Y: Restrict to lower 80% to avoid title bar (starts at 20%)
                    y = Math.random() * 75 + 20; 
                    
                    // Simple exclusion zone check (center is 50,50)
                    // We increase exclusion radius to 40% to account for mobile screens
                    const dx = x - 50;
                    const dy = y - 50;
                    dist = Math.sqrt(dx*dx + dy*dy);
                    attempts++;
                } while (dist < 40 && attempts < 50); // Exclusion radius ~40%
                return { x, y };
            };

            const shuffled = allItems.sort(() => Math.random() - 0.5).map(item => ({
              ...item,
              ...generatePosition(),
              rotation: 0, 
              id: item.id + Math.random().toString(36).substr(2, 9) 
            }));

            setAvailableItems(shuffled);
            setPlacedItems([]);
            setScore(0);
            setGameState('playing');
            setMessage({ text: 'The Circle is unbalanced. Drag items from the scattered pile to their homes.', type: 'info' });
          }, []);

          const handleDragStart = (item) => {
            setDraggedItem(item);
          };

          // Handle Drop on Target Slices
          const handleDrop = (e, targetDir) => {
            e.preventDefault();
            e.stopPropagation(); // Stop bubbling so background drop doesn't fire
            if (!draggedItem) return;

            if (draggedItem.target === targetDir) {
              setScore(prev => prev + 10);
              setPlacedItems(prev => [...prev, { ...draggedItem, placedAt: targetDir }]);
              setAvailableItems(prev => prev.filter(i => i.id !== draggedItem.id));
              setMessage({ text: `Correct! ${draggedItem.text} is part of the ${targetDir}.`, type: 'success' });
              
              if (availableItems.length === 1) {
                setGameState('complete');
              }
            } else {
              setScore(prev => Math.max(0, prev - 5));
              setMessage({ text: `That belongs in a different direction. Try again!`, type: 'error' });
            }
            setDraggedItem(null);
          };

          // Handle Drop on Background (Reorganizing)
          const handleBackgroundDrop = (e) => {
             e.preventDefault();
             if(!draggedItem) return;
             
             // Calculate percentage position
             const newX = (e.clientX / window.innerWidth) * 100;
             const newY = (e.clientY / window.innerHeight) * 100;

             setAvailableItems(prev => prev.map(item =>
                 item.id === draggedItem.id ? { ...item, x: newX, y: newY } : item
             ));
             setDraggedItem(null);
          }

          // Handle Click on Wedge for Hints
          const handleWedgeClick = (direction) => {
              if (gameState !== 'playing') return;
              setMessage({ text: TEACHINGS[direction].hint, type: 'info' });
          };

          return (
            <div className="h-screen w-full bg-stone-200 font-sans text-stone-900 flex flex-col items-center overflow-hidden relative">
              {/* Header UI - Floating */}
              <div className="absolute top-4 left-4 right-4 z-50 flex justify-center pointer-events-none">
                  <div className="w-full max-w-4xl flex justify-between items-center bg-white/90 backdrop-blur p-3 rounded-2xl shadow-sm border border-stone-300 pointer-events-auto">
                    <div className="flex items-center gap-3">
                      <div className="bg-amber-100 p-2 rounded-lg">
                        <Heart className="text-amber-600 fill-amber-600" size={20} />
                      </div>
                      <h1 className="text-lg font-bold tracking-tight hidden md:block">Sacred Circle Teachings</h1>
                    </div>
                    
                    <div className="flex items-center gap-6">
                        <div className={`px-4 py-1 rounded-full font-bold text-sm transition-all ${
                            message.type === 'success' ? 'bg-green-100 text-green-700' : 
                            message.type === 'error' ? 'bg-red-100 text-red-700' : 'bg-stone-100 text-stone-600'
                            }`}>
                            {message.text}
                        </div>
                      
                      {gameState === 'playing' && (
                        <button 
                            onClick={() => setGameState('intro')}
                            className="flex items-center gap-2 hover:bg-stone-100 px-3 py-1 rounded-lg transition-colors text-stone-600 font-bold text-sm"
                            title="Back to Teachings"
                        >
                            <BookOpen size={18} />
                            <span className="hidden sm:inline">Teachings</span>
                        </button>
                      )}

                      <div className="flex flex-col items-end">
                        <span className="text-[10px] uppercase font-bold text-stone-500">Score</span>
                        <span className="text-xl font-black text-amber-600">{score}</span>
                      </div>
                      <button onClick={() => setShowInfo(!showInfo)} className="p-2 hover:bg-stone-100 rounded-full transition-colors">
                        <Info size={20} />
                      </button>
                    </div>
                  </div>
              </div>

              {/* Intro Screen */}
              {gameState === 'intro' && (
                <div className="h-full flex items-center justify-center p-4">
                    <div className="max-w-2xl bg-white p-10 rounded-3xl shadow-xl border border-stone-300 text-center animate-in fade-in zoom-in duration-500">
                    <div className="mb-6 flex justify-center">
                        <div className="relative w-24 h-24 rounded-full overflow-hidden border-4 border-stone-800 rotate-45 grid grid-cols-2">
                            <div className="bg-zinc-100"></div><div className="bg-yellow-400"></div>
                            <div className="bg-blue-600"></div><div className="bg-red-500"></div>
                        </div>
                    </div>
                    <h2 className="text-3xl font-bold mb-4">Miyawâto - Welcome</h2>
                    <p className="text-stone-600 mb-8 leading-relaxed">
                        The Medicine Wheel helps us understand our place in the world. 
                        Before we play, let's learn the teachings of the four directions, starting in the East.
                    </p>
                    <button 
                        onClick={startTeaching}
                        className="group flex items-center gap-3 bg-stone-900 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:bg-stone-800 transition-all hover:scale-105 justify-center mx-auto"
                    >
                        Learn the Teachings <BookOpen size={20} />
                    </button>
                    </div>
                </div>
              )}

              {/* Teaching Phase */}
              {gameState === 'teaching' && (
                <div className="h-full flex items-center justify-center p-4 w-full">
                    <div className="w-full max-w-4xl animate-in fade-in slide-in-from-right-8 duration-500">
                    <div className={`rounded-3xl shadow-2xl overflow-hidden border-4 border-white flex flex-col md:flex-row min-h-[500px]`}>
                        {/* Visual Side */}
                        <div className={`md:w-1/2 p-12 flex items-center justify-center ${TEACHINGS[teachingOrder[teachingIndex]].color}`}>
                        <div className="text-center">
                            <h3 className={`text-5xl font-black uppercase mb-2 ${TEACHINGS[teachingOrder[teachingIndex]].textColor}`}>
                            {TEACHINGS[teachingOrder[teachingIndex]].label}
                            </h3>
                            <p className={`text-xl font-bold italic opacity-80 ${TEACHINGS[teachingOrder[teachingIndex]].textColor}`}>
                            {TEACHINGS[teachingOrder[teachingIndex]].direction}
                            </p>
                        </div>
                        </div>
                        {/* Content Side */}
                        <div className="md:w-1/2 bg-white p-8 md:p-12 flex flex-col justify-between">
                        <div>
                            <span className="text-xs font-black text-amber-600 uppercase tracking-widest block mb-4">
                            Direction {teachingIndex + 1} of 4
                            </span>
                            <p className="text-xl text-stone-700 leading-relaxed mb-8">
                            {TEACHINGS[teachingOrder[teachingIndex]].description}
                            </p>
                            <div className="grid grid-cols-1 gap-3">
                            {TEACHINGS[teachingOrder[teachingIndex]].items.slice(0, 3).map(item => (
                                <div key={item.id} className="bg-stone-100 p-3 rounded-xl border border-stone-200 flex items-center gap-4">
                                <div className="bg-white p-2 rounded-lg shadow-sm text-stone-600">
                                    {Icons[item.icon]("w-6 h-6")}
                                </div>
                                <div>
                                    <span className="text-[10px] uppercase font-bold text-stone-400 block">{item.category}</span>
                                    <span className="font-bold text-stone-800">{item.text}</span>
                                </div>
                                </div>
                            ))}
                            </div>
                        </div>
                        <button 
                            onClick={nextTeaching}
                            className="mt-8 flex items-center justify-center gap-2 bg-stone-900 text-white py-4 rounded-xl font-bold hover:bg-stone-800 transition-all"
                        >
                            {teachingIndex === 3 ? "Start the Challenge" : "Continue to Next Direction"} <ArrowRight size={20} />
                        </button>
                        </div>
                    </div>
                    </div>
                </div>
              )}

              {/* Main Game Phase - SCATTER MODE */}
              {gameState === 'playing' && (
                <div 
                  className="relative w-full h-full flex items-center justify-center overflow-hidden"
                  onDragOver={(e) => e.preventDefault()}
                  onDrop={handleBackgroundDrop}
                >
                    
                    {/* SCATTERED ITEMS */}
                    {availableItems.map((item) => (
                        <div
                        key={item.id}
                        draggable
                        onDragStart={() => handleDragStart(item)}
                        style={{ 
                            left: `${item.x}%`, 
                            top: `${item.y}%`,
                            transform: `translate(-50%, -50%) rotate(${item.rotation}deg)` 
                        }}
                        className={`absolute bg-white p-2 rounded-xl shadow-md border border-stone-200 cursor-grab active:cursor-grabbing 
                                    hover:border-amber-400 hover:scale-110 hover:z-50 transition-all flex flex-col items-center w-20 text-center z-20 
                                    ${draggedItem?.id === item.id ? 'opacity-40' : 'opacity-100'}
                                    ${draggedItem?.id && draggedItem.id !== item.id ? 'pointer-events-none' : ''}`} // FIX: Only disable events on OTHER items
                        >
                        <div className="mb-1 text-stone-500">
                            {Icons[item.icon]("w-6 h-6")}
                        </div>
                        <span className="text-[9px] font-bold text-stone-800 leading-tight">{item.text}</span>
                        </div>
                    ))}

                    {/* CENTRAL WHEEL */}
                    <div className="relative w-[300px] h-[300px] md:w-[480px] md:h-[480px] z-10 scale-90 md:scale-100">
                      {/* Grid Container rotated 45 degrees */}
                      <div className="absolute inset-0 rounded-full border-8 border-stone-800 shadow-2xl overflow-hidden grid grid-cols-2 grid-rows-2 rotate-45 bg-white">
                        {/* North (White) - Top Left Cell -> Top Wedge */}
                        <div 
                          onClick={() => handleWedgeClick('north')}
                          onDragOver={(e) => e.preventDefault()} onDrop={(e) => handleDrop(e, 'north')}
                          className={`${TEACHINGS.north.color} ${TEACHINGS.north.hoverColor} flex flex-col items-center justify-center border-r border-b border-stone-200/50 transition-colors cursor-pointer group`}>
                           <div className="-rotate-45 flex flex-col items-center justify-center w-full h-full">
                               <span className="text-stone-400 font-black text-sm uppercase opacity-40 group-hover:opacity-100 transition-opacity">North</span>
                               <div className="flex flex-wrap justify-center gap-1 p-2 pointer-events-none">
                                {placedItems.filter(i => i.placedAt === 'north').map(i => (
                                  <div key={i.id} className="bg-white/80 p-1 rounded-lg flex items-center gap-1 shadow-sm animate-bounce">
                                    {Icons[i.icon]("w-3 h-3 text-stone-500")}
                                    <span className="text-[8px] md:text-[10px] font-bold">{i.text}</span>
                                  </div>
                                ))}
                               </div>
                           </div>
                        </div>
                        {/* East (Yellow) - Top Right Cell -> Right Wedge */}
                        <div 
                          onClick={() => handleWedgeClick('east')}
                          onDragOver={(e) => e.preventDefault()} onDrop={(e) => handleDrop(e, 'east')}
                          className={`${TEACHINGS.east.color} ${TEACHINGS.east.hoverColor} flex flex-col items-center justify-center border-b border-stone-200/50 transition-colors cursor-pointer group`}>
                           <div className="-rotate-45 flex flex-col items-center justify-center w-full h-full">
                               <span className="text-yellow-800 font-black text-sm uppercase opacity-40 group-hover:opacity-100 transition-opacity">East</span>
                               <div className="flex flex-wrap justify-center gap-1 p-2 pointer-events-none">
                                {placedItems.filter(i => i.placedAt === 'east').map(i => (
                                  <div key={i.id} className="bg-white/80 p-1 rounded-lg flex items-center gap-1 shadow-sm animate-bounce">
                                    {Icons[i.icon]("w-3 h-3 text-yellow-600")}
                                    <span className="text-[8px] md:text-[10px] font-bold">{i.text}</span>
                                  </div>
                                ))}
                               </div>
                           </div>
                        </div>
                        {/* West (Blue) - Bottom Left Cell -> Left Wedge */}
                        <div 
                          onClick={() => handleWedgeClick('west')}
                          onDragOver={(e) => e.preventDefault()} onDrop={(e) => handleDrop(e, 'west')}
                          className={`${TEACHINGS.west.color} ${TEACHINGS.west.hoverColor} flex flex-col items-center justify-center border-r border-stone-200/50 transition-colors cursor-pointer group`}>
                           <div className="-rotate-45 flex flex-col items-center justify-center w-full h-full">
                               <div className="flex flex-wrap justify-center gap-1 p-2 order-2 pointer-events-none">
                                {placedItems.filter(i => i.placedAt === 'west').map(i => (
                                  <div key={i.id} className="bg-white/20 p-1 rounded-lg flex items-center gap-1 shadow-sm animate-bounce">
                                    {Icons[i.icon]("w-3 h-3 text-white")}
                                    <span className="text-[8px] md:text-[10px] text-white font-bold">{i.text}</span>
                                  </div>
                                ))}
                               </div>
                               <span className="text-blue-100 font-black text-sm uppercase opacity-40 order-1 group-hover:opacity-100 transition-opacity">West</span>
                           </div>
                        </div>
                        {/* South (Red) - Bottom Right Cell -> Bottom Wedge */}
                        <div 
                          onClick={() => handleWedgeClick('south')}
                          onDragOver={(e) => e.preventDefault()} onDrop={(e) => handleDrop(e, 'south')}
                          className={`${TEACHINGS.south.color} ${TEACHINGS.south.hoverColor} flex flex-col items-center justify-center transition-colors cursor-pointer group`}>
                           <div className="-rotate-45 flex flex-col items-center justify-center w-full h-full">
                               <div className="flex flex-wrap justify-center gap-1 p-2 order-2 pointer-events-none">
                                {placedItems.filter(i => i.placedAt === 'south').map(i => (
                                  <div key={i.id} className="bg-white/80 p-1 rounded-lg flex items-center gap-1 shadow-sm animate-bounce">
                                    {Icons[i.icon]("w-3 h-3 text-red-600")}
                                    <span className="text-[8px] md:text-[10px] font-bold">{i.text}</span>
                                  </div>
                                ))}
                               </div>
                               <span className="text-red-900 font-black text-sm uppercase opacity-40 order-1 group-hover:opacity-100 transition-opacity">South</span>
                           </div>
                        </div>
                      </div>
                      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-16 h-16 md:w-24 md:h-24 bg-stone-800 rounded-full border-4 border-stone-200 flex items-center justify-center z-10 shadow-xl pointer-events-none">
                         <div className="text-white text-[10px] md:text-xs font-bold text-center leading-tight uppercase">Center<br/>Balance</div>
                      </div>
                    </div>

                </div>
              )}

              {/* Completion Screen */}
              {gameState === 'complete' && (
                <div className="h-full flex items-center justify-center p-4">
                    <div className="max-w-2xl bg-white p-10 rounded-3xl shadow-2xl border border-stone-300 text-center animate-in zoom-in duration-700">
                    <div className="mb-6 flex justify-center"><Trophy className="text-amber-500" size={80} /></div>
                    <h2 className="text-4xl font-black mb-4">Harmony Achieved!</h2>
                    <div className="text-6xl font-black text-stone-900 mb-6">{score} <span className="text-2xl text-stone-400">PTS</span></div>
                    <p className="text-stone-600 mb-8 text-lg leading-relaxed">
                        Hiy Hiy! You have honored the teachings of the four directions. 
                        By understanding the balance of the physical, mental, emotional, and spiritual selves, 
                        you help keep the world in harmony.
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onClick={startTeaching} className="flex items-center justify-center gap-2 bg-stone-900 text-white px-6 py-4 rounded-2xl font-bold hover:bg-stone-800 transition-all">
                        <RotateCcw size={20} /> Restart Lessons
                        </button>
                        <div className="bg-amber-50 text-amber-800 px-6 py-4 rounded-2xl font-bold border border-amber-200 flex items-center justify-center gap-2">
                        <CheckCircle2 size={20} /> Sacred Circle Honor
                        </div>
                    </div>
                    </div>
                </div>
              )}

              {/* Info Modal */}
              {showInfo && (
                <div className="fixed inset-0 bg-stone-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                  <div className="bg-white max-w-2xl w-full rounded-3xl shadow-2xl overflow-hidden animate-in fade-in slide-in-from-bottom-4">
                    <div className="p-8">
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="text-2xl font-bold">Protocol & Purpose</h3>
                        <button onClick={() => setShowInfo(false)} className="text-stone-400 hover:text-stone-900 text-2xl font-bold">&times;</button>
                      </div>
                      <p className="text-stone-600 mb-4 italic">The Medicine Wheel is a living teaching tool used across Alberta's Indigenous communities. While colors and animals may vary slightly, the clockwise movement represents the natural flow of life.</p>
                      <div className="bg-stone-100 p-4 rounded-xl border border-stone-200 text-sm text-stone-700">
                        <strong>Did you know?</strong> Moving clockwise (Sunwise) is a sign of respect for the way the sun travels across the sky, bringing light to each direction in turn.
                      </div>
                      <button onClick={() => setShowInfo(false)} className="w-full mt-8 bg-stone-900 text-white py-4 rounded-xl font-bold">Close</button>
                    </div>
                  </div>
                </div>
              )}

              <style>{`
                @keyframes shake {
                  0%, 100% { transform: translateX(0); }
                  25% { transform: translateX(-5px); }
                  75% { transform: translateX(5px); }
                }
                .shake { animation: shake 0.2s ease-in-out 0s 2; }
              `}</style>
            </div>
          );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
