<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solid, Liquid, Gas Sorting Activity (Grade 5)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.5;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            /* Prevent pull-to-refresh and other touch behaviors during drag */
            overscroll-behavior-y: contain;
        }
        .activity-container {
            width: 100%;
            max-width: 960px;
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        h1 {
            font-size: 2em;
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 15px;
        }
        h2 {
            font-size: 1.4em;
            font-weight: 500;
            color: #34495e;
            text-align: center;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        .instructions {
            background-color: #e0f2f1;
            border-left: 5px solid #00796b;
            padding: 12px 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #004d40;
        }
        .unsorted-items-container {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            min-height: 90px;
        }
        .unsorted-items-container h3 {
            margin-top: 0;
            margin-bottom: 12px;
            color: #495057;
            text-align: center;
            font-size: 1.2em;
            font-weight: 500;
        }
        .sortable-item-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
        .sortable-item {
            background-color: #5dade2;
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.88em;
            font-weight: 500;
            cursor: grab;
            min-width: 190px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.07);
            transition: all 0.25s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 2px solid transparent;
            /* For touch dragging, ensure it's on top */
            position: relative; /* Will be changed to fixed/absolute during touch drag */
        }
        .sortable-item:hover {
            background-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .sortable-item.dragging, .sortable-item.touch-dragging { /* Combined class for visual feedback */
            opacity: 0.6;
            transform: scale(0.95);
            cursor: grabbing;
            z-index: 1000; /* Ensure dragged item is on top */
        }
        .sortable-item.item-correct {
            border-color: #2ecc71;
            background-color: #e8f8f5;
            color: #1abc9c;
            font-weight: 600;
        }
        .sortable-item.item-incorrect {
            border-color: #e74c3c;
            background-color: #fdedec;
            color: #c0392b;
            font-weight: 600;
        }
        .categories-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
            gap: 20px;
        }
        .category-column {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .category-column h3 {
            color: #00796b;
            margin-top: 0;
            margin-bottom: 12px;
            border-bottom: 2px solid #b2dfdb;
            padding-bottom: 10px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1.1em;
            font-weight: 600;
        }
        .drop-zone {
            min-height: 90px;
            background-color: #fbfcfc;
            border-radius: 6px;
            border: 2px dashed #ced4da;
            padding: 10px;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .drop-zone.drag-over, .drop-zone.touch-over { /* Combined class for visual feedback */
            background-color: #e0f2f1;
            border-color: #00796b;
        }
        #feedback-message {
            text-align: center;
            margin-top: 20px;
            padding: 12px 15px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 1em;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #feedback-message.success-overall {
            background-color: #d1e7dd;
            color: #0f5132;
        }
        #feedback-message.error-overall {
            background-color: #f8d7da;
            color: #842029;
        }
        .action-buttons {
            text-align: center;
            margin-top: 25px;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .action-buttons button {
            padding: 12px 25px;
            font-size: 0.95em;
            font-weight: 600;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .action-buttons button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }
        .action-buttons button:active {
            transform: translateY(0px);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        #check-answers-btn {
            background-color: #27ae60;
            color: white;
        }
        #check-answers-btn:hover {
            background-color: #229954;
        }
        #reset-btn {
            background-color: #3498db;
            color: white;
        }
        #reset-btn:hover {
            background-color: #2980b9;
        }
        /* Style for the element being dragged by touch */
        .touch-drag-ghost {
            position: absolute; /* Or fixed, depending on scroll behavior desired */
            pointer-events: none; /* So it doesn't interfere with elementFromPoint */
            /* Copy styles from .sortable-item if not cloning the node directly */
        }
    </style>
</head>
<body>
    <div class="activity-container">
        <h1>Solid, Liquid, Gas Sorting</h1>
        <p class="instructions">
            Drag each item to the best box: Solid, Liquid, or Gas. Then click "Check Answers"!
        </p>

        <div class="unsorted-items-container drop-zone" id="unsorted-zone" data-category-target="unsorted"> <h3>Sortable Items</h3>
            <div class="sortable-item-list" id="initial-list-container">
                <div class="sortable-item" draggable="true" id="item1" data-category="solid">üß± Particles super close & just wiggle.</div>
                <div class="sortable-item" draggable="true" id="item2" data-category="solid">üßä Keeps its own shape & size.</div>
                <div class="sortable-item" draggable="true" id="item3" data-category="solid">üí™ Particles stick together strongly.</div>
                <div class="sortable-item" draggable="true" id="item4" data-category="solid">üö´üí® Hard to squash.</div>
                <div class="sortable-item" draggable="true" id="item5" data-category="liquid">üíß Particles close & can slide around.</div>
                <div class="sortable-item" draggable="true" id="item6" data-category="liquid">ü•§ Takes container's shape, keeps size.</div>
                <div class="sortable-item" draggable="true" id="item7" data-category="liquid">‚ÜîÔ∏è Particles stick together a bit.</div>
                <div class="sortable-item" draggable="true" id="item8" data-category="liquid">ü§èüí® A little hard to squash.</div>
                <div class="sortable-item" draggable="true" id="item9" data-category="gas">üí® Particles spread out & zoom everywhere.</div>
                <div class="sortable-item" draggable="true" id="item10" data-category="gas">üéà Spreads out to fill any container.</div>
                <div class="sortable-item" draggable="true" id="item11" data-category="gas">üå¨Ô∏è Particles don't stick much.</div>
                <div class="sortable-item" draggable="true" id="item12" data-category="gas">‚è¨üí® Easy to squash.</div>
            </div>
        </div>

        <h2>Categories</h2>
        <div class="categories-container">
            <div class="category-column">
                <h3>üß± SOLID</h3>
                <div class="drop-zone" id="category-solid" data-category-target="solid"></div>
            </div>
            <div class="category-column">
                <h3>üíß LIQUID</h3>
                <div class="drop-zone" id="category-liquid" data-category-target="liquid"></div>
            </div>
            <div class="category-column">
                <h3>üí® GAS</h3>
                <div class="drop-zone" id="category-gas" data-category-target="gas"></div>
            </div>
        </div>

        <div class="action-buttons">
            <button id="check-answers-btn">Check Answers</button>
            <button id="reset-btn">Reset Activity</button>
        </div>
        <div id="feedback-message"></div>
    </div>

    <script>
        const feedbackMessage = document.getElementById('feedback-message');
        const checkAnswersBtn = document.getElementById('check-answers-btn');
        const resetBtn = document.getElementById('reset-btn');
        const initialListContainer = document.getElementById('initial-list-container');
        const allDropZones = Array.from(document.querySelectorAll('.drop-zone')); // NodeList to Array

        let draggedItem = null; // For both mouse and touch
        let touchDragGhost = null; // Visual element for touch dragging
        let currentTouchOverZone = null;

        function initializeItems() {
            document.querySelectorAll('.sortable-item').forEach(item => {
                // Mouse Drag Events
                item.removeEventListener('dragstart', handleMouseDragStart);
                item.addEventListener('dragstart', handleMouseDragStart);
                item.removeEventListener('dragend', handleMouseDragEnd);
                item.addEventListener('dragend', handleMouseDragEnd);

                // Touch Events
                item.removeEventListener('touchstart', handleTouchStart);
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
            });
        }
        
        // Mouse Drag Handlers
        function handleMouseDragStart(event) {
            draggedItem = event.target;
            event.dataTransfer.setData('text/plain', event.target.id);
            setTimeout(() => event.target.classList.add('dragging'), 0);
            clearItemFeedback(draggedItem);
        }

        function handleMouseDragEnd() {
            if (draggedItem) {
                draggedItem.classList.remove('dragging');
            }
            draggedItem = null;
            allDropZones.forEach(zone => zone.classList.remove('drag-over'));
        }

        // Touch Event Handlers
        function handleTouchStart(event) {
            event.preventDefault(); // Prevent page scroll, zoom
            draggedItem = event.target.closest('.sortable-item');
            if (!draggedItem) return;

            clearItemFeedback(draggedItem);
            
            // Create a "ghost" for dragging
            touchDragGhost = draggedItem.cloneNode(true);
            touchDragGhost.classList.add('touch-drag-ghost', 'dragging'); // Apply dragging style
            document.body.appendChild(touchDragGhost);
            
            // Position the ghost
            const touch = event.targetTouches[0];
            positionGhost(touch.pageX, touch.pageY);
            
            // Hide original item by reducing opacity, but keep its space
            draggedItem.style.opacity = '0.4';


            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd, { passive: false });
        }

        function positionGhost(x, y) {
            if (touchDragGhost) {
                // Center the ghost under the finger
                touchDragGhost.style.left = `${x - touchDragGhost.offsetWidth / 2}px`;
                touchDragGhost.style.top = `${y - touchDragGhost.offsetHeight / 2}px`;
            }
        }

        function handleTouchMove(event) {
            event.preventDefault(); // Prevent scrolling
            if (!draggedItem || !touchDragGhost) return;

            const touch = event.targetTouches[0];
            positionGhost(touch.pageX, touch.pageY);

            // Element under touch
            touchDragGhost.style.display = 'none'; // Temporarily hide ghost to find element underneath
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            touchDragGhost.style.display = ''; // Show ghost again

            let potentialZone = elementBelow ? elementBelow.closest('.drop-zone') : null;
            
            if (currentTouchOverZone && currentTouchOverZone !== potentialZone) {
                currentTouchOverZone.classList.remove('touch-over');
            }
            if (potentialZone) {
                potentialZone.classList.add('touch-over');
                currentTouchOverZone = potentialZone;
            } else {
                currentTouchOverZone = null;
            }
        }

        function handleTouchEnd(event) {
            if (!draggedItem || !touchDragGhost) return;

            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);

            if (currentTouchOverZone) {
                if (currentTouchOverZone.id === 'unsorted-zone') {
                    initialListContainer.appendChild(draggedItem);
                } else {
                    currentTouchOverZone.appendChild(draggedItem);
                }
                currentTouchOverZone.classList.remove('touch-over');
            }
            // If not dropped in a zone, it will remain in its original parent visually due to opacity reset.
            // For this version, if not over a zone, it effectively snaps back when opacity is restored.

            draggedItem.style.opacity = '1'; // Restore original item visibility
            document.body.removeChild(touchDragGhost); // Remove ghost
            
            touchDragGhost = null;
            draggedItem = null;
            currentTouchOverZone = null;
        }

        // Common Drop Zone Logic (for mouse)
        allDropZones.forEach(zone => {
            zone.addEventListener('dragover', (event) => {
                event.preventDefault();
                zone.classList.add('drag-over');
            });
            zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
            zone.addEventListener('drop', (event) => {
                event.preventDefault();
                zone.classList.remove('drag-over');
                if (draggedItem) { // draggedItem is set by handleMouseDragStart
                    if (zone.id === 'unsorted-zone') {
                        initialListContainer.appendChild(draggedItem);
                    } else {
                        zone.appendChild(draggedItem);
                    }
                    clearItemFeedback(draggedItem);
                }
                // draggedItem is reset in handleMouseDragEnd
            });
        });

        function clearItemFeedback(item) {
            if (item) {
                item.classList.remove('item-correct', 'item-incorrect');
            }
            feedbackMessage.textContent = '';
            feedbackMessage.className = '';
        }
        
        checkAnswersBtn.addEventListener('click', () => {
            let correctCount = 0;
            let totalPlaced = 0;
            
            document.querySelectorAll('.sortable-item').forEach(item => {
                item.classList.remove('item-correct', 'item-incorrect');
            });

            ['category-solid', 'category-liquid', 'category-gas'].forEach(zoneId => {
                const zone = document.getElementById(zoneId);
                const itemsInZone = zone.querySelectorAll('.sortable-item');
                const zoneAccepts = zone.dataset.categoryTarget;

                itemsInZone.forEach(item => {
                    totalPlaced++;
                    const itemIs = item.dataset.category;
                    if (itemIs === zoneAccepts) {
                        item.classList.add('item-correct');
                        correctCount++;
                    } else {
                        item.classList.add('item-incorrect');
                    }
                });
            });

            const itemsInUnsorted = initialListContainer.querySelectorAll('.sortable-item');
            itemsInUnsorted.forEach(item => {
                item.classList.add('item-incorrect'); 
            });
            
            const totalSortableItems = document.querySelectorAll('.sortable-item[data-category]').length;

            if (totalPlaced === 0 && itemsInUnsorted.length === totalSortableItems) {
                 feedbackMessage.textContent = "Drag the items to the boxes to sort them!";
                 feedbackMessage.className = '';
            } else if (itemsInUnsorted.length > 0) { // Simplified condition: if any unsorted, guide user
                feedbackMessage.textContent = `You sorted ${correctCount} out of ${totalPlaced} items correctly. ${itemsInUnsorted.length} item(s) still need to be sorted!`;
                feedbackMessage.className = (correctCount > 0 && totalPlaced > 0 && correctCount === totalPlaced) ? 'success-overall' : 'error-overall';
            }
            else { // All items are placed
                feedbackMessage.textContent = `You got ${correctCount} out of ${totalSortableItems} correct!`;
                if (correctCount === totalSortableItems) {
                    feedbackMessage.className = 'success-overall';
                } else {
                    feedbackMessage.className = 'error-overall';
                }
            }
        });

        resetBtn.addEventListener('click', () => {
            const allItems = document.querySelectorAll('.sortable-item[data-category]'); // Get all original items
            allItems.forEach(item => {
                initialListContainer.appendChild(item); // Move to initial container
                item.classList.remove('item-correct', 'item-incorrect', 'dragging', 'touch-dragging');
                item.style.opacity = '1'; // Ensure opacity is reset
            });
            feedbackMessage.textContent = 'Activity Reset. Try again!';
            feedbackMessage.className = '';
            if (touchDragGhost && touchDragGhost.parentElement) { // Clean up ghost if reset mid-drag
                document.body.removeChild(touchDragGhost);
                touchDragGhost = null;
            }
            draggedItem = null; // Reset dragged item state
        });

        initializeItems(); // Initial setup
    </script>
</body>
</html>
