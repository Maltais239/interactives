<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venn Diagram Sorting Activity - Consistent Ghost Dragging</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; overscroll-behavior-y: contain; }
        .sortable-item { touch-action: none; cursor: grab; transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, opacity 0.2s ease-out, border-color 0.2s ease-out; user-select: none; padding: 0.5rem 0.75rem; border-radius: 0.375rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 2px solid transparent; background-color: #fff; margin-bottom: 0.5rem; display: flex; align-items: center; justify-content: center; min-width: 100px; }
        .sortable-item.dragging { opacity: 0.4 !important; }
        .item-bank-drop-zone { border: 2px dashed #d1d5db; min-height: 150px; padding: 0.75rem; border-radius: 0.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; overflow-y: auto; }
        .venn-drop-zone { border: none; min-height: 400px; padding: 0.75rem; border-radius: 0.5rem; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; overflow-y: auto; }
        .drag-over { background-color: #e0e7ff !important; border-color: #a5b4fc !important; }
        .ghost-image { position: absolute; pointer-events: none; opacity: 0.75; transform: scale(0.95); z-index: 1000; padding: 0.5rem 0.75rem; border-radius: 0.375rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; background-color: #fff; text-align: center; }
        #vennDiagramLayout { width: 100%; max-width: 700px; height: 520px; position: relative; margin: 0 auto; }
        .visual-circle { position: absolute; border-radius: 50%; pointer-events: none; }
        .zone-label { font-weight: 600; color: #4b5563; margin-bottom: 0.5rem; position: relative; z-index: 1; }
        .correct-placement { border-color: #10b981 !important; box-shadow: 0 0 8px #10b981; }
        .incorrect-placement { border-color: #ef4444 !important; box-shadow: 0 0 8px #ef4444; }
        #feedbackArea { min-height: 1.5rem; }
    </style>
</head>
<body class="p-4 md:p-6">
    <div class="max-w-6xl mx-auto bg-white p-6 rounded-xl shadow-2xl">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-indigo-600">Venn Diagram Sorting</h1>
            <p class="text-gray-600 mt-1">Drag items to the correct part of the Venn diagram.</p>
        </header>
        <div class="flex flex-col lg:flex-row gap-6">
            <aside class="lg:w-1/3 bg-gray-50 p-4 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-700 mb-3 text-center">Items to Sort</h2>
                <div id="itemBank" class="item-bank-drop-zone"></div>
            </aside>
            <main class="lg:w-2/3 flex flex-col items-center">
                <div class="w-full flex justify-around mb-2 px-4">
                    <h3 id="categoryALabelText" class="text-lg font-semibold text-blue-600">Category A</h3>
                    <h3 id="categoryBLabelText" class="text-lg font-semibold text-red-600">Category B</h3>
                </div>
                <div id="vennDiagramLayout">
                    <div id="visualCircleA" class="visual-circle bg-blue-400 opacity-40 w-[420px] h-[420px] top-[50px] left-[calc(50%_-_325px)]"></div>
                    <div id="visualCircleB" class="visual-circle bg-red-400 opacity-40 w-[420px] h-[420px] top-[50px] left-[calc(50%_-_95px)]"></div>
                    <div id="dropZoneAOnly" data-zone-name="A_only" class="venn-drop-zone absolute w-[230px] h-[420px] top-[50px] left-[calc(50%_-_325px)]">
                        <span class="zone-label text-blue-700">A Only</span>
                    </div>
                    <div id="dropZoneIntersection" data-zone-name="Intersection" class="venn-drop-zone absolute w-[190px] h-[420px] top-[50px] left-[calc(50%_-_95px)]">
                        <span class="zone-label text-purple-700">A & B</span>
                    </div>
                    <div id="dropZoneBOnly" data-zone-name="B_only" class="venn-drop-zone absolute w-[230px] h-[420px] top-[50px] left-[calc(50%_+_95px)]">
                        <span class="zone-label text-red-700">B Only</span>
                    </div>
                </div>
                <div id="feedbackArea" class="mt-4 text-center text-lg font-semibold"></div>
                <div class="mt-6 flex justify-center space-x-4">
                    <button id="checkAnswersButton" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-lg shadow transition-colors">Check Answers</button>
                    <button id="resetButton" class="bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-6 rounded-lg shadow transition-colors">Reset Diagram</button>
                </div>
            </main>
        </div>
    </div>
    <script>
        // Configuration
        let sortableItemsData = [
            { id: 'item1', text: '🦆 Duck', belongsToA: true, belongsToB: true },
            { id: 'item2', text: '🐠 Fish', belongsToA: true, belongsToB: false },
            { id: 'item3', text: '🦅 Eagle', belongsToA: false, belongsToB: true },
            { id: 'item4', text: '🐶 Dog', belongsToA: false, belongsToB: false },
            { id: 'item5', text: '🦇 Bat', belongsToA: false, belongsToB: true },
            { id: 'item6', text: '🐧 Penguin', belongsToA: true, belongsToB: false },
            { id: 'item7', text: '🦋 Butterfly', belongsToA: false, belongsToB: true },
            { id: 'item8', text: '🐳 Whale', belongsToA: true, belongsToB: false },
        ];
        const categoryALabel = "Swims";
        const categoryBLabel = "Flies";

        // Globals
        let itemBankElement, dropZoneAOnlyElement, dropZoneIntersectionElement, dropZoneBOnlyElement;
        let resetButtonElement, checkAnswersButtonElement, feedbackAreaElement;
        let draggedItem = null, ghostImageElement = null;
        let touchOffsetX = 0, touchOffsetY = 0;
        let originalVisibility = '';
        let mouseOffsetX = 0, mouseOffsetY = 0;
        const transparentPixel = 'data:image/gif;base64,R0lGODlhAQABAIAAAA…';

        function determineCorrectZone(item) {
            if (item.belongsToA && item.belongsToB) return 'Intersection';
            if (item.belongsToA) return 'A_only';
            if (item.belongsToB) return 'B_only';
            return 'itemBank';
        }
        function preprocessItemData() {
            sortableItemsData = sortableItemsData.map(item => ({ ...item, correctZone: determineCorrectZone(item) }));
        }
        function createSortableItemElement(itemData) {
            const div = document.createElement('div');
            div.classList.add('sortable-item'); div.setAttribute('draggable', true);
            div.setAttribute('data-item-id', itemData.id); div.textContent = itemData.text;
            div.addEventListener('dragstart', handleDragStart);
            div.addEventListener('dragend', handleDragEnd);
            div.addEventListener('touchstart', handleTouchStart, { passive: false });
            return div;
        }
        function populateItemBank() { itemBankElement.innerHTML = ''; sortableItemsData.forEach(itemData => itemBankElement.appendChild(createSortableItemElement(itemData))); clearAllFeedback(); }
        function setupCategoryLabels() {
            document.getElementById('categoryALabelText').textContent = categoryALabel;
            document.getElementById('categoryBLabelText').textContent = categoryBLabel;
            dropZoneAOnlyElement.querySelector('.zone-label').textContent = `${categoryALabel} Only`;
            dropZoneIntersectionElement.querySelector('.zone-label').textContent = `${categoryALabel} & ${categoryBLabel}`;
            dropZoneBOnlyElement.querySelector('.zone-label').textContent = `${categoryBLabel} Only`;
        }
        function clearAllFeedback() {
            document.querySelectorAll('.sortable-item').forEach(it => it.classList.remove('correct-placement','incorrect-placement'));
            feedbackAreaElement.textContent = '';
        }

        // Mouse handlers
        function handleDragStart(e) {
            draggedItem = e.target; clearAllFeedback(); originalVisibility = draggedItem.style.visibility;
            const rect = draggedItem.getBoundingClientRect(); mouseOffsetX = e.clientX-rect.left; mouseOffsetY = e.clientY-rect.top;
            ghostImageElement = draggedItem.cloneNode(true); ghostImageElement.classList.add('ghost-image');
            ghostImageElement.style.width=`${rect.width}px`; ghostImageElement.style.height=`${rect.height}px`;
            ghostImageElement.style.left=`${e.clientX-mouseOffsetX}px`; ghostImageElement.style.top=`${e.clientY-mouseOffsetY}px`;
            document.body.appendChild(ghostImageElement);
            setTimeout(()=>draggedItem.style.visibility='hidden',0);
            e.dataTransfer.setData('text/plain',draggedItem.dataset.itemId);
            const img=new Image(); img.src=transparentPixel; e.dataTransfer.setDragImage(img,0,0);
            document.addEventListener('dragover',handleDocumentDragOver);
        }
        function handleDocumentDragOver(e){ e.preventDefault(); if(ghostImageElement){ ghostImageElement.style.left=`${e.clientX-mouseOffsetX}px`; ghostImageElement.style.top=`${e.clientY-mouseOffsetY}px`; }}
        function handleDragEnd(e){ if(draggedItem){ draggedItem.style.visibility=originalVisibility; } if(ghostImageElement){ ghostImageElement.remove(); ghostImageElement=null;} document.removeEventListener('dragover',handleDocumentDragOver); document.querySelectorAll('.drag-over').forEach(z=>z.classList.remove('drag-over')); draggedItem=null; }
        function handleDragOver(e){ e.preventDefault(); e.currentTarget.classList.add('drag-over'); e.dataTransfer.dropEffect='move'; }
        function handleDragLeave(e){ if(!e.currentTarget.contains(e.relatedTarget)) e.currentTarget.classList.remove('drag-over'); }
        function handleDrop(e){ e.preventDefault(); performDrop(e.currentTarget,draggedItem); e.currentTarget.classList.remove('drag-over'); }

        // Touch handlers (immediate ghost, unified behavior)
        function handleTouchStart(e){ e.preventDefault(); draggedItem=e.currentTarget; clearAllFeedback(); originalVisibility=draggedItem.style.visibility;
            const touch=e.touches[0]; const rect=draggedItem.getBoundingClientRect(); touchOffsetX=touch.clientX-rect.left; touchOffsetY=touch.clientY-rect.top;
            ghostImageElement=draggedItem.cloneNode(true); ghostImageElement.classList.add('ghost-image');
            ghostImageElement.style.width=`${rect.width}px`; ghostImageElement.style.height=`${rect.height}px`;
            document.body.appendChild(ghostImageElement);
            draggedItem.classList.add('dragging'); draggedItem.style.visibility='hidden';
        }
        function handleTouchMove(e){ if(!ghostImageElement) return; e.preventDefault(); const touch=e.touches[0]; ghostImageElement.style.left=`${touch.clientX-touchOffsetX}px`; ghostImageElement.style.top=`${touch.clientY-touchOffsetY}px`;
            document.querySelectorAll('.venn-drop-zone, .item-bank-drop-zone').forEach(z=>z.classList.remove('drag-over'));
            const el=document.elementFromPoint(touch.clientX,touch.clientY);
            const zone=el?.closest('.venn-drop-zone, .item-bank-drop-zone'); if(zone) zone.classList.add('drag-over');
        }
        function handleTouchEnd(e){ if(!ghostImageElement||!draggedItem) return; e.preventDefault();
            const touch=e.changedTouches[0]; const el=document.elementFromPoint(touch.clientX,touch.clientY);
            const zone=el?.closest('.venn-drop-zone, .item-bank-drop-zone'); if(zone) performDrop(zone,draggedItem);
            draggedItem.classList.remove('dragging'); draggedItem.style.visibility=originalVisibility;
            ghostImageElement.remove(); ghostImageElement=null; draggedItem=null;
            document.querySelectorAll('.drag-over').forEach(z=>z.classList.remove('drag-over'));
        }

        function performDrop(target,item){ clearAllFeedback(); target.appendChild(item); }
        function handleCheckAnswers(){ clearAllFeedback(); let correct=0, total=0;
            [dropZoneAOnlyElement,dropZoneIntersectionElement,dropZoneBOnlyElement].forEach(z=>{ z.querySelectorAll('.sortable-item').forEach(it=>{ total++; const d=sortableItemsData.find(d=>d.id===it.dataset.itemId);
                    if(d&&d.correctZone===z.dataset.zoneName){ it.classList.add('correct-placement'); correct++; } else it.classList.add('incorrect-placement'); }); });
            const placable=sortableItemsData.filter(i=>i.correctZone!=='itemBank').length;
            if(total===0&&placable>0){ feedbackAreaElement.textContent="Drag some items into the Venn diagram to check your answers!"; feedbackAreaElement.className='mt-4 text-center text-lg font-semibold text-gray-600'; }
            else if(total>0){ feedbackAreaElement.textContent=`You correctly placed ${correct} out of ${total} items.`;
                feedbackAreaElement.className=correct===total&&total===placable?'mt-4 text-center text-lg font-semibold text-green-600':correct===total?'mt-4 text-center text-lg font-semibold text-green-600':'mt-4 text-center text-lg font-semibold text-orange-600'; }
            else{ feedbackAreaElement.textContent="The diagram is empty or all items belong in the bank."; feedbackAreaElement.className='mt-4 text-center text-lg font-semibold text-gray-600'; }
        }
        function resetDiagram(){ document.querySelectorAll('.venn-drop-zone .sortable-item').forEach(it=>it.remove()); populateItemBank(); setupCategoryLabels(); }

        function initializeVennSorter(){ preprocessItemData();
            itemBankElement=document.getElementById('itemBank'); dropZoneAOnlyElement=document.getElementById('dropZoneAOnly');
            dropZoneIntersectionElement=document.getElementById('dropZoneIntersection'); dropZoneBOnlyElement=document.getElementById('dropZoneBOnly');
            resetButtonElement=document.getElementById('resetButton'); checkAnswersButtonElement=document.getElementById('checkAnswersButton'); feedbackAreaElement=document.getElementById('feedbackArea');
            if(![itemBankElement,dropZoneAOnlyElement,dropZoneIntersectionElement,dropZoneBOnlyElement,resetButtonElement,checkAnswersButtonElement,feedbackAreaElement].every(e=>e)) return;
            populateItemBank(); setupCategoryLabels();
            [itemBankElement,dropZoneAOnlyElement,dropZoneIntersectionElement,dropZoneBOnlyElement].forEach(z=>{ z.addEventListener('dragover',handleDragOver); z.addEventListener('dragleave',handleDragLeave); z.addEventListener('drop',handleDrop); });
            resetButtonElement.addEventListener('click',resetDiagram); checkAnswersButtonElement.addEventListener('click',handleCheckAnswers);
            document.addEventListener('touchmove',handleTouchMove,{passive:false}); document.addEventListener('touchend',handleTouchEnd);
        }
        document.addEventListener('DOMContentLoaded',initializeVennSorter);
    </script>
</body>
</html>
